<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HISTORY | KMA 한국대표단</title>

    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/sub.css">

    <script src="../js/header.js"></script>
   
</head>
<body>
    <div id="container">

        <!-- header -->
        <div id="header">
            <a href="../index.html"><img src="../assets/imgs/atdLogo4.webp" alt="ATD2025 logo" class="header-logo"></a>
        
            <div class="pc-cate">
                <ul class="main-cate">
                    <li>ATD 25</li>
                    <li>KMA-ATD 25</li>
                    <li><a href="">K-TD</a></li>
                    <li><a href="../etc/faq.html">FAQ</a></li>
                    <li><a href="../etc/hstr.html">HISTORY</a></li>
                </ul>
                <ul class="sub-cate-1 sub-cate">
                    <li><a href="../atd25/abtAtd25.html">About ATD 25</a></li>
                    <li><a href="../atd25/kntSpk.html">키노트 스피커</a></li>
                    <li><a href="../atd25/lngTr.html">학습 과정</a></li>
                    <li><a href="../atd25/scd.html">일정</a></li>
                </ul>
                <ul class="sub-cate-2 sub-cate">
                    <li><a href="../kmaAtd25/team.html">팀별 일정표</a></li>
                    <li><a href="../kmaAtd25/spcPrg.html">스페셜 프로그램</a></li>
                    <li><a href="../kmaAtd25/cdnGrp.html">코디네이터 그룹</a></li>
                    <li><a href="../kmaAtd25/cost.html">참가비용</a></li>
                </ul>
            </div>
            
            <button class="menu-btn"></button>

            <!-- menu-wrap -->
            <div class="cate-wrap">
                <div class="top">
                    <button class="close-btn"></button>
                </div>
                <ul class="cate">
                    <li><a href="">HOME</a></li>
                    <li>
                        ATD 25
                        <ul>
                            <li><a href="../atd25/abtAtd25.html">About ATD 2025</a></li>
                            <li><a href="../atd25/kntSpk.html">키노트 스피커</a></li>
                            <li><a href="../atd25/lngTr.html">학습 과정</a></li>
                            <li><a href="../atd25/scd.html">일정</a></li>
                        </ul>
                    </li>
                    <li>
                        KMA ATD 25
                        <ul>
                            <li><a href="../kmaAtd25/team.html">팀별 일정표</a></li>
                            <li><a href="../kmaAtd25/spcPrg.html">스페셜 프로그램</a></li>
                            <li><a href="../kmaAtd25/cdnGrp.html">코디네이터 그룹</a></li>
                            <li><a href="../kmaAtd25/ktdPrg.html">K-TD 프로그램</a></li>
                            <li><a href="../kmaAtd25/cost.html">참가비용</a></li>
                        </ul>
                    </li>
                    <li><a href="">K-TD</a></li>
                    <li><a href="../etc/faq.html">FAQ</a></li>
                    <li><a href="../etc/hstr.html">HISTORY</a></li>
                </ul>
            </div>

            <div class="bg-over"></div>
        </div>

        <!-- pg-top -->
        <div class="pg-top">
            <div class="pg-wrap">
                <p class="pg-sub"><br></p>
                <p class="pg-tit">HISTORY</p>
            </div>
        </div>

        <div class="hstr-wrap">
            <div id="gallery"></div>
            <div id="loading">
                <button id="loadMore">더보기</button>
            </div>
        </div>
    </div>

    <!-- 팝업 요소 -->
    <div id="popup" class="hidden">
        <div class="popup-content">
            <button id="closePopup" class="close-btn"></button>
            <img id="popupImage" src="" alt="확대된 이미지">
        </div>
    </div> 

    <script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const gallery = document.getElementById("gallery");
            const loadMoreButton = document.getElementById("loadMore");

            if (!gallery || !loadMoreButton) {
                console.error("❌ 필수 DOM 요소를 찾을 수 없습니다.");
                return;
            }

            let images = []; // JSON 데이터를 저장할 배열
            let currentIndex = 0; // 현재 인덱스
            const batchSize = 20; // 한 번에 불러올 이미지 개수

            // JSON 데이터 로드
            fetch("image.json")
                .then((response) => {
                    if (!response.ok) throw new Error("❌ JSON 파일을 불러올 수 없습니다.");
                    return response.json();
                })
                .then((data) => {
                    images = data.length > 0 ? data : [{ src: "placeholder.jpg" }];
                    loadImages(); // 처음 이미지를 로드
                    loadMoreButton.style.display = "block";
                })
                .catch((error) => {
                    console.error(error);
                    loadMoreButton.style.display = "none";
                });

            // Masonry 레이아웃 조정 함수
            function resizeGridItems() {
                const items = document.querySelectorAll('.gallery-item');
                items.forEach(item => {
                    const rowHeight = parseInt(window.getComputedStyle(gallery).getPropertyValue('grid-auto-rows'));
                    const rowGap = parseInt(window.getComputedStyle(gallery).getPropertyValue('gap'));
                    const img = item.querySelector('img');

                    if (img.complete) {
                        const rowSpan = Math.ceil((img.offsetHeight + rowGap) / (rowHeight + rowGap));
                        item.style.gridRowEnd = `span ${rowSpan}`;
                        item.style.minHeight = "100px"; // 최소 높이 적용
                    } else {
                        img.addEventListener('load', () => {
                            const rowSpan = Math.ceil((img.offsetHeight + rowGap) / (rowHeight + rowGap));
                            item.style.gridRowEnd = `span ${rowSpan}`;
                            item.style.minHeight = "100px"; // 최소 높이 적용
                        });
                    }
                });
            }

            // 이미지 추가 함수
            function loadImages() {
                const fragment = document.createDocumentFragment();

                for (let i = currentIndex; i < currentIndex + batchSize; i++) {
                    if (i >= images.length) break;

                    const item = document.createElement("div");
                    item.classList.add("gallery-item");

                    const img = document.createElement("img");
                    img.src = images[i].src;
                    img.alt = `갤러리 이미지 ${i + 1}`;
                    img.loading = "lazy";
                    img.onerror = () => {
                        img.src = "placeholder.jpg";
                        console.error(`❌ 이미지 로드 실패: ${img.src}`);
                    };

                    item.appendChild(img);
                    fragment.appendChild(item);
                }

                gallery.appendChild(fragment);
                resizeGridItems(); // Masonry 레이아웃 조정

                currentIndex += batchSize;

                if (currentIndex >= images.length) {
                    loadMoreButton.style.display = "none"; // 더 이상 로드할 이미지가 없으면 버튼 숨기기
                    const noMoreText = document.createElement("p");
                    noMoreText.innerText = " ";
                    document.getElementById("loading").appendChild(noMoreText);
                }
            }

            // 더보기 버튼 클릭 이벤트
            loadMoreButton.addEventListener("click", () => loadImages());

            // 창 크기가 변경될 때 Masonry 레이아웃 재조정
            window.addEventListener('resize', resizeGridItems);
        });
    </script>

</body>
</html>